[]: https://juejin.im/post/5c889918e51d45346459994d?utm_source=gold_browser_extension



# 一、`HTTP`

- `HTTP(Hyper Text Transfer Protocol)`超文本传输协议，位于TCP/IP四层模型当中的应用层。

- HTTP协议通过请求/响应的方式，在客户端和服务端之间进行通信。
- HTTP协议的信息传输完全以明文方式，不做任何加密，相当于是在网络上**裸奔**，因此HTTP协议是不够安全的。
- 

## 1.1.HTTP协议与TCP/IP协议的关系

- HTTP的长连接和短连接本质是说TCP的长连接和短连接

  > 注意：HTTP协议本身是没有长短连接
  >
  >
  > 原因：它是一个应用层协议，HTTP协议是基于请求/响应模式的，因此只要服务端给了响应，本次HTTP连接就结束了；下一次又是一个新的请求和新的响应

- HTTP属于应用层协议，在传输层使用TCP协议，在网络层使用IP协议

  - IP协议主要解决网络路由和寻址问题；
  - TCP协议主要解决如何在IP层之上可靠地传递数据包，使得网络上接收端收到发送端所发出的所有包，并且顺序与发送顺序一致

  - TCP协议是可靠的、面向连接的


## 1.2.HTTP无状态

> 如何理解HTTP协议是无状态的?

- HTTP协议是无状态的，指的是协议对于事务处理没有记忆能力，服务器不知道客户端是什么状态(打开一个服务器上的网页和上一次打开这个服务器上的网页之间没有任何联系)
- HTTP是一个无状态的面向连接的协议，无状态不代表HTTP不能保持TCP连接，更不能代表HTTP使用的是UDP协议（无连接）

## 1.3.长连接

- 长连接是数据传输完成了保持TCP连接不断开（不发RST包、不四次握手），等待在同域名下继续用这个通道传输数据

- `HTTP/1.1`默认使用的是`TCP`长连接
  - 会在响应头中添加`Connection:keep-alive`
  - 在长连接情况下，完成一个请求后，客户端和服务器端传送HTTP数据的TCP连接不会关闭，客户端再次请求时，会继续使用该连接
  - `Keep-Alive`不会永久保存连接，它有一个保持时间，在服务器软件中设定该时间
  - 注意：实现长连接需要客户端和服务器端都支持长连接

## 1.4.短连接

- 短连接是数据传输完成了立即断开TCP连接，下次使用时在重新获取连接

- `HTTP/1.0`默认使用的是`TCP`短连接

  - 客户端和服务端每次HTTP请求，都是新建一个连接，请求结束连接就断开

# 二、`TCP/IP`

- TCP/IP 不是一个协议，是一个协议族，包含IP协议、IMCP协议、TCP协议、HTTP、FTP、POP3协议等
- TCP/IP提供点对点的链接机制，将数据应该如何封装、定址、传输、路由以及在目的地如何接收，都加以标  准化
- 

## 2.1.`TCP/IP `协议分层

![1540352693007](E:\typora\images\1540352693007.png)

> ISO/OSI模型，即开放式通信系统互联参考模型（Open System Interconnection Reference Model），是国际标准化组织（ISO）提出的一个试图使各种计算机在世界范围内互连为网络的标准框架，简称OSI

- 通常把`TCP/IP`协议族分为四层，若是五层就在数据链路层下加一个物理层

### 2.1.1.协议每层对应的设备

网络层：路由器

数据链路层：网桥、交换机

物理层：网卡、网线、集线器、中继器、调制解调器

- 集线器是物理层设备，采用广播的形式传播信息
- 交换机是交换报文信息的机器，多为链路层设备（二层交互机），能够进行地址学习，采用存储转发的形式来交换报文
- 路由器的作用
  1. 连通不同的网络
  2. 选择信息传输的线路（选择通畅快捷的近路，能大大提高通信速度，减轻网络系统通信负荷，节约网络系统资源，提高网络系统畅通率）

### 2.1.2.`TCP/IP`协议每层的作用

| `TCP/IP`模型 | 作用                                         | 协议                                                         |
| ------------ | -------------------------------------------- | ------------------------------------------------------------ |
| 应用层       | 用于不同的应用程序                           | telent远程登录、FTP文件传输协议、SMTP简单邮件传输协议、SNMP简单网络管理协议 |
| 运输层       | 主要为不同主机上两个应用程序提供端到端的通信 | TCP协议、UDP协议                                             |
| 网络层       | 处理分组在网络中活动，如分组选路             | IP协议、ICMP协议、IGMP协议                                   |
| 数据链路层   | 处理与电缆或其他任何传输媒介的物理接口       | ARP地址解析协议、RARP逆向地址解析协议                        |

- IP是一种网络层协议，提供的是一种不可靠的服务，它只是尽可能快地把分组从源结点送到目的结点，但是、并不提供任何可靠性保证。
- IP协议同时被TCP和UDP使用。TCP和UDP的每组数据都通过端系统和每个中间路、由器中的IP层在互联网中进行传输
- ICMP是IP协议的附属协议。IP层用它来与其它主机或路由器交换错误报文和其他重要信息。
- GMP是Internet组管理协议。它用来把一个UDP数据报多播到多个主机。
- TCP是一个传输控制协议，它为两台主机提供了可靠性的数据通信，它所做的工作包括把应用程序交给它的数据进行合适的分块交给下层的网络层，确认接收到的分组，设置发送最后确认分组的超时时钟等
- UDP是用户数据报协议，它为应用层提供了简单的服务，它只是把称作数据报的分组从一台主机发送到另外一台主机，并不保证该数据报能到达另外一端。

## 2.2.`TCP`

- 网络通信时采用TCP协议时，在真正的读写操作之前，客户端与服务器端之间必须建立一个连接，当读写操作完成后，双方不再需要这个连接时可以释放这个连接。
- 连接的建立依靠“三次握手”，而释放则需要“四次握手”，所以每个连接的建立都是需要资源消耗和时间消耗的
- TCP连接是一个双向通道，可以保持一段时间不关闭

### 2.2.1.`TCP`的报头



![](E:\typora\images\20180524114307959.png)

- 源端口号：发送端端口号，字长16位；
- 目的端口号：接收端端口号，字长16位；
- 序列号：发送数据的位置，字长32位；
  - 每发送一次数据，就累加一次发送数据字节数的大小
  - 序列号初始值不是从0或1，而是在建立连接时由计算机生成的一个随机数，通过SYN包发送给接收端主机，然后再将每次发送的字节数累加到初始值上表示数据的位置
- 确认应答号：下一次应该收到的数据的序列号，字段长为32字节；
  - 发送端在收到这个确认应答以后，就认为在这个序号以前的数据都已经被正常接收
- 4位首部长度：
- 保留：为以后扩展使用，字长4位
- 控制位：字长6位，值为1时有具体含义
  - URG:紧急指针是否有效，表示某一位需要被优先处理
  - ACK:确认号是否有效，一般设为1
  - PSH:提示接收端应用程序立即从TCP缓冲区把数据读走
  - RST:对方要求重新建立连接，复位
  - SYN:请求建立连接，并在其序列号的字段进行序列号的初始值设定；建立连接，设置为1
  - FIN:希望断开连接
- 窗口大小：接收缓冲区的大小，TCP不允许发送超过此处所示大小的数据
- 校验和：发送端填充，CRC校验，接收校验不通过，则认为数据有问题
  - 与UDP的区别是，UDP校验的是数据本身，TCP校验的不仅包含TCP首部，而且包含TCP数据部分
- 紧急指针：只有在URG为1时有效，表示本报文的段中的紧急数据的指针
- 选项：用于提高TCP的传输性能；需要根据首部长度进行控制，其最大长度为40字节



![](E:\typora\images\20180524114415368.png)

### 2.2.1.建立连接（三次握手）







### 2.2.2.释放连接（四次握手）





> 问题：为什么是四次挥手，而不是三次或是五次、六次?

- 因为双方关闭连接要经过双方都同意；
  - 首先是客服端给服务器发送FIN，要求关闭连接，服务器收到后会发送一个ACK进行确认。

  - 服务器然后再发送一个FIN，客户端发送ACK确认，并进入TIME_WAIT状态。等待2MSL后自动关闭。





![](E:\typora\images\20170719160146313.png)

# 三、`HTTPS`

`HTTPS`是在`HTTP`协议的基础上添加了`SSL`安全层，`SSL`层的流程：

- 对称加密：
- 非对称加密：有一组密钥对，包含公钥与私钥；
  - 明文既可以用公钥加密，用私钥解密；
  - 也可以用私钥加密，用公钥解密

 