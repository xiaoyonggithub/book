# 一、`zxing`

## 1.1.依赖的jar

```xml
<dependency>
    <groupId>com.google.zxing</groupId>
    <artifactId>core</artifactId>
    <version>3.2.1</version>
</dependency>
<dependency>
    <groupId>com.google.zxing</groupId>
    <artifactId>javase</artifactId>
    <version>3.2.1</version>
</dependency>
```

## 1.2.二维码的生成

```java
//设置二维码参数
Map hints  = new HashMap();
//设置编码
hints .put(EncodeHintType.CHARACTER_SET,"utf-8");
//设置纠错等级
hints .put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.M);
//设置边距
hints .put(EncodeHintType.MARGIN,2);
//内容
String content = "www.baidu.com";
//大小
int width = 200;
int height = 200;
//生成二维码矩阵
BitMatrix bitMatrix = new MultiFormatWriter().encode(content, BarcodeFormat.QR_CODE, width, height, hints);
//设置保存路径
Path path = new File("F:/code.png").toPath();
//保存二维码
MatrixToImageWriter.writeToPath(bitMatrix,"png",path);
```

## 1.3.读取二维码

```java
ultiFormatReader mfr = new MultiFormatReader();
//读取图片
BufferedImage bi = ImageIO.read(new File("f:/code.png"));
//定义二维码参数
Map hints = new HashMap();
//设置编码
hints.put(EncodeHintType.CHARACTER_SET,"utf-8");

//读取二维码
BinaryBitmap bb = new BinaryBitmap(new HybridBinarizer(new BufferedImageLuminanceSource(bi)));
//解析二维码
Result result = mfr.decode(bb, hints);

String s = result.toString();
//获取二维码的格式
BarcodeFormat format = result.getBarcodeFormat();
//获取二维码的内容
String text = result.getText();
```

## 1.4.带`logo`的二维码生成

1. 生成二维码
2. 在二维码上绘制logo图标
3. 绘制logo的边框

```java
//设置二维码参数
Map hints = new HashMap();
//设置编码
hints.put(EncodeHintType.CHARACTER_SET, "utf-8");
//设置纠错等级
hints.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.M);
//设置边距
hints.put(EncodeHintType.MARGIN, 2);
//内容
String content = "logo";
//大小
int width = 200;
int height = 200;
//生成二维码
BitMatrix bitMatrix = new MultiFormatWriter().encode(content, BarcodeFormat.QR_CODE, width, height, hints);
//设置保存路径
File file = new File("F:/code.png");

//============绘制图标==============
//创建图片缓存区
BufferedImage bi = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);
//设置颜色
for (int i = 0; i < width; i++) {
    for (int j = 0; j < height; j++) {
        bi.setRGB(i,j,(bitMatrix.get(i,j) ? 0xFF000000 :0xFFFFFFFF));
    }
}
//获取绘图对象
Graphics2D graphics = bi.createGraphics();
//获取logo图片
BufferedImage logo = ImageIO.read(new File("F:\\(2).jpg"));
//绘制图片
graphics.drawImage(logo,width / 5 * 2, height / 5 * 2, width / 5, height / 5,null);
//graphics.drawImage(logo, width / 5 * 2, height / 5 * 2, null);
//设置笔画对象
BasicStroke stroke = new BasicStroke(5, BasicStroke.CAP_ROUND, BasicStroke.JOIN_ROUND);
graphics.setStroke(stroke);
//指定圆弧矩形
RoundRectangle2D.Float rect = new RoundRectangle2D.Float(width / 5 * 2, height / 5 * 2, width / 5, height / 5, 20, 20);
//设置颜色
graphics.setColor(Color.white);
//绘制圆弧矩形
graphics.draw(rect);

//设置绘制logo灰色边框的笔画
BasicStroke stroke2 = new BasicStroke(1, BasicStroke.CAP_ROUND, BasicStroke.JOIN_ROUND);
graphics.setStroke(stroke2);
//指定边框的矩形
RoundRectangle2D.Float rectBoder = new RoundRectangle2D.Float(width / 5 * 2 + 2, height / 5 * 2 + 2, width / 5 - 4, height / 5 - 4, 20, 20);
//设置边框颜色
graphics.setColor(new Color(128,128,128));
//绘制边框
graphics.draw(rectBoder);

graphics.dispose();
bi.flush();

ImageIO.write(bi,"png",file);
```



# 二、`QRCode.jar`

## 2.1.生成二维码

```java
Qrcode qrcode = new Qrcode();
//纠错级别（L 7%、M 15%、Q 25%、H 30%）和版本有关
qrcode.setQrcodeEncodeMode('M');
//设置编码模式,N代表数字，A代表a-Z，B代表其它字符
qrcode.setQrcodeEncodeMode('B');
//设置Qrcode包的版本,1-40个版本
qrcode.setQrcodeVersion(7);

//计算二维码图片的高宽比
int v = 7; //Qrcode包的版本
int width = 67 + 12 * (v - 1);
int height = 67 + 12 * (v - 1);

BufferedImage bi = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);
//创建图层
Graphics2D graphics = bi.createGraphics();
// 设置背景颜色（白色）
graphics.setBackground(Color.WHITE);
// 矩形 X、Y、width、height
graphics.clearRect(0, 0, width, height);
// 设置图像颜色（黑色）
graphics.setColor(Color.BLACK);

String text = "qrcode二维码";
byte[] bytes = text.getBytes(StandardCharsets.UTF_8);

//设置偏移量
int pixoff = 2;
if (bytes.length > 0 && bytes.length < 200) {
    boolean[][] b = qrcode.calQrcode(bytes);
    for (int i = 0; i < b.length; i++) {
        for (int j = 0; j < b.length; j++) {
            //注意b[j][i]二维数组的j，i的顺序要与方法中的 graphics.fillRect(j*3+pixoff,i*3+pixoff, 3, 3)顺序一致
            if (b[j][i]) {
                graphics.fillRect(j * 3 + pixoff, i * 3 + pixoff, 3, 3);
            }
        }
    }
}

//释放资源
graphics.dispose();
bi.flush();
ImageIO.write(bi, "png", new File("f:\\code.png"));
```

## 2.2.解析二维码

```java
public class MyQRCodeImage implements QRCodeImage {

    BufferedImage bi;

    public MyQRCodeImage(BufferedImage bi) {
        this.bi = bi;
    }

    @Override
    public int getWidth() {
        return bi.getWidth();
    }

    @Override
    public int getHeight() {
        return bi.getHeight();
    }

    @Override
    public int getPixel(int i, int i1) {
        return bi.getRGB(i, i1);
    }
}
```

```java
//读取图片到缓存区
BufferedImage bi = ImageIO.read(new File("f:\\code.png"));
//创建解码器
QRCodeDecoder decoder = new QRCodeDecoder();
//解析二维码
byte[] bytes = decoder.decode(new MyQRCodeImage(bi));
//二维码内容
String content = new String(bytes,"UTF-8");
```



# 三、`QRCode.js`

QRCode.js 是一个用于生成二维码的 JavaScript 库；主要是通过获取 DOM 的标签,再通过 HTML5 Canvas 绘制而成,不依赖任何库

```html
<div id="qrcode"></div>
<script type="text/javascript" src="js/qrcode.js"></script>
<script type="text/javascript">
    //生成二维码
	new QRCode(document.getElementById("qrcode"), "http://jindo.dev.naver.com/collie");
    
    //
    var qrcode = new QRCode(document.getElementById("qrcode"), {
        text: "http://jindo.dev.naver.com/collie",  //内容
        width: 128,  //宽度
        height: 128, //高度
        colorDark : "#000000",  //前景色
        colorLight : "#ffffff", //背景色
        correctLevel : QRCode.CorrectLevel.H  //容错级别
    });
    
    //清除二维码，仅在不支持 Canvas 的浏览器下有效
    qrcode.clear(); 
    //重新绘制，修改二维码内容
	qrcode.makeCode("http://naver.com"); 
</script>
```

## 3.1.容错级别

- `QRCode.CorrectLevel.L`
- `QRCode.CorrectLevel.M`
- `QRCode.CorrectLevel.Q`
- `QRCode.CorrectLevel.H`

## 3.2.将生成的二维码保存为本地图片

```html
<a id="downloadLink"></a>
<button type="button" onclick="downloadClick()">下载</button>
```

```js
//js
function downloadClick () {
    // 获取base64的图片节点
    var img = document.getElementById('qrcode').getElementsByTagName('img')[0];
    // 构建画布
    var canvas = document.createElement('canvas');
    canvas.width = img.width;
    canvas.height = img.height;
    canvas.getContext('2d').drawImage(img, 0, 0);
    // 构造url
    url = canvas.toDataURL('image/png');
    // 构造a标签并模拟点击
    var downloadLink = document.getElementById('downloadLink');
    downloadLink.setAttribute('href', url);
    downloadLink.setAttribute('download', '二维码.png');
    downloadLink.click();
}
```

```js
//jquery
function downloadClick () {
    // 获取base64的图片节点
    var img = $('#qrcode img').[0];
    // 构建画布
    var canvas = document.createElement('canvas');
    canvas.width = img.width;
    canvas.height = img.height;
    canvas.getContext('2d').drawImage(img, 0, 0);
    // 构造url
    url = canvas.toDataURL('image/png');
    // 构造a标签并模拟点击
    var downloadLink = $('#downloadLink').attr("href", url).attr("download", "二维码.png");
    downloadLink[0].click();
}
```





# 四、`jquery.qrcode.js`

```js
<script type="text/javascript" src="js/jquery.qrcode.js"></script>
<div id="qrcode"></div>
<script>
    $(function(){
    	//生成二维码
        $('#qrcode').qrcode("http://www.jq22.com");
    });
</script>
```

```js
$('#qrcode').qrcode({
    render: "table",     //设置渲染方式
    text: "http://www.jq22.com",  //内容
    width: 100,    
    height: 100,
    foreground: "#C00",  //前景色
    background: "#FFF",  //背景色
});
```

- `render`:渲染方式
  - `table`
  - `canvas`

- 中文url需要转码

```js
$("#output").qrcode(encodeURI("http://中文中文"));//使用encodeURI进行转码
```

